{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Password-based single-teacher login, change password UI, and DEV Classes logo update",
  "requirements": [
    {
      "id": "REQ-10",
      "summary": "Gate all teacher/admin UI actions behind a single password-based login state and require teacher password for teacher data operations in the UI.",
      "acceptanceCriteria": [
        "All backend methods that currently rely on `ensureAdminOrTeacher(caller)` (or equivalent role checks) require successful password authentication instead.",
        "Students can continue accessing student flows without any authentication changes.",
        "Teacher-only pages (dashboard, quiz editor, results) are inaccessible until the correct teacher password is provided.",
        "No Internet Identity login/logout UI is required for teacher access after this change."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useTeacherPasswordAuth.ts",
          "operation": "create",
          "description": "Create a dedicated teacher password auth hook (session-based) that stores/clears the teacher password (e.g., in sessionStorage) and exposes teacher login/logout helpers plus a boolean \"isTeacherAuthenticated\" for gating teacher UI."
        },
        {
          "path": "frontend/src/components/TeacherGate.tsx",
          "operation": "modify",
          "description": "Replace Internet Identity + role-based gating with password-based gating: show a password prompt when not authenticated, call backend verifyAdminPassword via the actor, store password on success, and render children only when teacher password auth is active."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Update teacher/admin React Query hooks and mutations (teacher quizzes, create/update/publish quiz, results/attempts) to read the stored teacher password and pass it to the backend teacher/admin methods that now require it. Ensure student hooks remain unchanged."
        },
        {
          "path": "frontend/src/pages/teacher/TeacherDashboard.tsx",
          "operation": "modify",
          "description": "Ensure all teacher actions (list quizzes, publish) continue working with updated hooks that require teacher password auth; handle unauthorized errors gracefully by surfacing clear UI feedback (e.g., toast) when password is missing/invalid."
        },
        {
          "path": "frontend/src/pages/teacher/TeacherResults.tsx",
          "operation": "modify",
          "description": "Ensure teacher results loading uses updated hooks requiring the stored teacher password; handle missing/invalid password errors gracefully in the UI."
        },
        {
          "path": "frontend/src/pages/teacher/QuizEditor.tsx",
          "operation": "modify",
          "description": "Ensure create/update quiz flows use updated mutations requiring the stored teacher password; handle missing/invalid password errors gracefully in the UI."
        }
      ]
    },
    {
      "id": "REQ-12",
      "summary": "Add a teacher Change Password screen and wire it into the teacher portal UI using the backend change-password capability.",
      "acceptanceCriteria": [
        "Teacher can open a Change Password screen from the teacher portal UI.",
        "Form requires both Old Password and New Password fields; submission is blocked when either is empty.",
        "Backend rejects change-password attempts when the old password is incorrect.",
        "On successful password change, a success confirmation is shown in the UI and subsequent teacher actions require the new password."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/teacher/ChangePassword.tsx",
          "operation": "create",
          "description": "Create a teacher Change Password screen with Old Password + New Password fields, required-field validation, submit handling, and success/error messaging in English. On success, update the stored teacher password to the new password so subsequent teacher actions use it."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Wire the Change Password screen into the existing view-state navigation by adding a teacher change-password view and rendering the new page behind TeacherGate."
        },
        {
          "path": "frontend/src/pages/teacher/TeacherDashboard.tsx",
          "operation": "modify",
          "description": "Add a teacher-portal UI control (e.g., button) to navigate to the Change Password screen from the dashboard."
        },
        {
          "path": "frontend/src/hooks/useTeacherPasswordAuth.ts",
          "operation": "modify",
          "description": "Add helper(s) needed by Change Password flow (e.g., setter to replace stored password after successful change) and a logout/clear method to invalidate teacher session when desired."
        }
      ]
    },
    {
      "id": "REQ-13",
      "summary": "Update teacher portal gating and header controls to use password-based login state instead of useInternetIdentity, without touching immutable frontend paths.",
      "acceptanceCriteria": [
        "`frontend/src/components/TeacherGate.tsx` no longer requires Internet Identity sign-in and instead prompts for the teacher password when needed.",
        "`frontend/src/components/Header.tsx` no longer shows Internet Identity Sign In/Sign Out actions; it reflects teacher password login state (e.g., Sign In / Sign Out) appropriate for the password flow.",
        "No changes are made to the immutable hook files under `frontend/src/hooks/useInternetIdentity.ts` / `.tsx`, `frontend/src/hooks/useActor.ts`, `frontend/src/main.tsx`, or any files under `frontend/src/components/ui`."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/Header.tsx",
          "operation": "modify",
          "description": "Remove Internet Identity-based auth controls from the teacher header area and replace with password-flow controls: show teacher Sign Out when password-authenticated; otherwise show a Sign In action that routes the user into teacher mode (TeacherGate will prompt for password). Ensure query cache is cleared on teacher sign out."
        },
        {
          "path": "frontend/src/components/TeacherGate.tsx",
          "operation": "modify",
          "description": "Ensure TeacherGate relies only on password-auth state (from the new hook) and no longer imports/uses useInternetIdentity or the legacy role/registration flow for teacher access."
        },
        {
          "path": "frontend/src/hooks/useTeacherAuth.ts",
          "operation": "modify",
          "description": "Deprecate Internet Identity teacher role/registration usage for teacher portal access (stop using II state + role checks for gating). Adjust or remove exported behavior so the app no longer depends on II for teacher access, while keeping student flows unaffected."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Remove teacher-flow dependencies on Internet Identity state where not needed (do not introduce changes to immutable files). Ensure teacher pages remain wrapped by TeacherGate and remain inaccessible until password is provided."
        }
      ]
    },
    {
      "id": "REQ-14",
      "summary": "Replace the student and teacher portal logo with the DEV Classes logo across header branding.",
      "acceptanceCriteria": [
        "The header logo currently using `/assets/generated/quiz-logo.dim_512x512.png` is replaced to use the new DEV Classes logo asset.",
        "The updated logo appears consistently in both Student Portal and Teacher Portal header branding.",
        "All user-facing text related to branding remains in English."
      ],
      "file_operations": [
        {
          "path": "frontend/public/assets/generated/dev-classes-logo.dim_512x512.png",
          "operation": "create",
          "description": "Add the provided DEV Classes logo asset as a generated static asset at frontend/public/assets/generated/dev-classes-logo.dim_512x512.png."
        },
        {
          "path": "frontend/src/components/Header.tsx",
          "operation": "modify",
          "description": "Update the header branding image to use frontend/public/assets/generated/dev-classes-logo.dim_512x512.png instead of frontend/public/assets/generated/quiz-logo.dim_512x512.png, ensuring it appears in both student and teacher portal modes with English alt text/branding."
        }
      ]
    }
  ]
}